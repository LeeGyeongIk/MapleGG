<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Document</title>
</head>

<body>
    <style>
        #content {
            width: fit-content;
            height: fit-content;
            position: relative;
            margin: 0 auto;
        }

        #content_op {
            position: absolute;
            color: white;
            font-size: 1.2em;
            bottom: 21%;
            left: 6%;
            animation: cube 1s;
        }

        #total_price {
            position: absolute;
            right: 4%;
            color: gold;
            font-size: 1.2em;
            bottom: 13%;
            animation: cube 1s;
        }

        #cube_img {
            width: 400px;
        }

        #do_cube_btn {
            position: absolute;
            width: 74%;
            height: 6%;
            bottom: 2%;
            left: 2%;
            background-color: rgba(0, 0, 0, 0);
            border: none;
        }

        #reset_btn {
            position: absolute;
            width: 22%;
            height: 6%;
            bottom: 2%;
            left: 77%;
            background-color: rgba(0, 0, 0, 0);
            border: none;
        }

        @keyframes cube {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
    
    <form action="/cube_simulator" method="post">
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight"
            aria-labelledby="offcanvasRightLabel">
            <div class="offcanvas-header">
                <h5 id="offcanvasRightLabel">세팅</h5>
            </div>
            <div class="offcanvas-body" id="setting_section">
                <div class="dropdown">
                    <div style="border: 1px solid gray;border-radius: 5px;padding:5%;">
                        <h4>무기 등급 선택</h4>
                        <br>
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="select_grade_btn"
                            data-bs-toggle="dropdown" aria-expanded="false" style="width:100%">
                            무기 등급
                        </button>
                        <div class="mb-3">
                            <input type="text" class="form-control" id="select_grade" name="grade" style="display:none" required />
                        </div>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" style="width:100%">
                            <li onclick="set_grade(1)"><a class="dropdown-item" href="#">레어</a></li>
                            <li onclick="set_grade(2)"><a class="dropdown-item" href="#">에픽</a></li>
                            <li onclick="set_grade(3)"><a class="dropdown-item" href="#">유니크</a></li>
                            <li onclick="set_grade(4)"><a class="dropdown-item" href="#">레전드리</a></li>
                        </ul>
                    </div>
                </div>
                <br>
                <div class="dropdown">
                    <div style="border: 1px solid gray;border-radius: 5px;padding:5%;">
                        <h4>장비 종류 선택</h4>
                        <br>
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="select_parts_btn"
                            data-bs-toggle="dropdown" aria-expanded="false" style="width:100%">
                            장비 종류
                        </button>
                        <div class="mb-3">
                            <input type="text" class="form-control" id="select_parts_type" name="parts" style="display:none" required />
                        </div>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" style="width:100%">
                            <li onclick="$('#select_parts_type').val(1)"><a class="dropdown-item" href="#">무기</a></li>
                            <li onclick="$('#select_parts_type').val(2)"><a class="dropdown-item" href="#">엠블렘</a></li>
                            <li onclick="$('#select_parts_type').val(3)"><a class="dropdown-item" href="#">보조무기(포스실드,소울링제외)</a></li>
                            <li onclick="$('#select_parts_type').val(4)"><a class="dropdown-item" href="#">포스실드, 소울링</a></li>
                            <li onclick="$('#select_parts_type').val(5)"><a class="dropdown-item" href="#">방패</a></li>
                            <li onclick="$('#select_parts_type').val(6)"><a class="dropdown-item" href="#">모자</a></li>
                            <li onclick="$('#select_parts_type').val(7)"><a class="dropdown-item" href="#">상의</a></li>
                            <li onclick="$('#select_parts_type').val(8)"><a class="dropdown-item" href="#">한벌옷</a></li>
                            <li onclick="$('#select_parts_type').val(9)"><a class="dropdown-item" href="#">하의</a></li>
                            <li onclick="$('#select_parts_type').val(10)"><a class="dropdown-item" href="#">신발</a></li>
                            <li onclick="$('#select_parts_type').val(11)"><a class="dropdown-item" href="#">장갑</a></li>
                            <li onclick="$('#select_parts_type').val(12)"><a class="dropdown-item" href="#">망토</a></li>
                            <li onclick="$('#select_parts_type').val(13)"><a class="dropdown-item" href="#">벨트</a></li>
                            <li onclick="$('#select_parts_type').val(14)"><a class="dropdown-item" href="#">어깨장식</a></li>
                            <li onclick="$('#select_parts_type').val(15)"><a class="dropdown-item" href="#">얼굴장식</a></li>
                            <li onclick="$('#select_parts_type').val(16)"><a class="dropdown-item" href="#">눈장식</a></li>
                            <li onclick="$('#select_parts_type').val(17)"><a class="dropdown-item" href="#">귀고리</a></li>
                            <li onclick="$('#select_parts_type').val(18)"><a class="dropdown-item" href="#">반지</a></li>
                            <li onclick="$('#select_parts_type').val(19)"><a class="dropdown-item" href="#">펜던트</a></li>
                            <li onclick="$('#select_parts_type').val(20)"><a class="dropdown-item" href="#">기계심장</a></li>
                        </ul>
                    </div>
                </div>
                <br>
                <div style="border: 1px solid gray;border-radius: 5px;padding:5%;">
                    <h4>장비 레벨 입력</h4>
                    <br>
                    <div class="mb-3">
                        <label for="max_damage" class="form-label">장비 레벨을 0 ~ 250 사이 숫자로 입력</label>
                        <input type="number" class="form-control" id="level" placeholder="0 ~ 250까지의 레벨 입력" name="level" required />
                    </div>
                </div>
                <br>
                <div style="text-align:center">
                    <button type="submit" class="btn btn-primary" style="width:40%" id="apply">적용</button>
                    <button type="button" class="btn btn-danger" style="width:40%" id="cancel">취소</button>
                </div>
            </div>
        </div>
    </form>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand">잠재능력 시뮬레이터</a>
            <button style="border: 1px solid gray;border-radius: 5px;" id="setting_btn">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div id="content">
        <img src="../static/img/cube/그림1.png" id="cube_img">
        <button id="do_cube_btn"></button>
        <button id="reset_btn"></button>
    </div>

    <script>
        $("#do_cube_btn").click(function () {
            total_price += 1650 // 블큐 1개 가격
            $("#content_op").remove();
            $("#total_price").remove();
            $("#content").append(`<div id="content_op"></div>`);
            $("#content_op").append(`${do_cube(option1)}<br>`);
            $("#content_op").append(`${do_cube(option2)}<br>`);
            $("#content_op").append(`${do_cube(option3)}<br>`);
            $("#content").append(`<div id="total_price">사용한 금액: ${total_price.toLocaleString('ko-KR')}원<br></div>`);
        })

        $("#reset_btn").click(function () {
            $("#content_op").remove();
            $("#total_price").remove();
            total_price = 0;
        })

        $("#setting_btn").click(function () {
            $("#offcanvasRight").offcanvas("show");
        })

        $("#cancel").click(function () {
            $("#offcanvasRight").offcanvas("hide");
        })

        cube_probability = `{{cube_probability}}`.slice(1, -1);
        cube_probability = cube_probability.replaceAll("&gt;", ">");
        cube_probability = cube_probability.replaceAll("&lt;", "<");
        cube_probability = cube_probability.replaceAll("&#34;", "'");

        let option1 = new Object();
        let option2 = new Object();
        let option3 = new Object();
        let total_price = 0

        option1 = set_cube_probability(cube_probability);
        option2 = set_cube_probability(cube_probability);
        option3 = set_cube_probability(cube_probability);

        function do_cube(option) {
            let temp = 0;
            let cube_probability = (Math.random() * 100).toFixed(4);
            let option_result;

            for (var i = 0; i < Object.keys(option).length; i++) {
                if (cube_probability >= temp && cube_probability < Object.values(option)[i] + temp) {
                    option_result = Object.keys(option)[i].toString();
                    break;
                } else {
                    temp += Object.values(option)[i];
                }
            }

            return option_result
        }

        function set_cube_probability(raw_data) {
            let option = new Object();
            let object_temp1;
            let object_temp2;
            let processed_data;

            processed_data = raw_data.slice(raw_data.indexOf("<tbody>"), raw_data.indexOf("</tbody>") + "</tbody>".length);
            cube_probability = cube_probability.replace(processed_data, "");
            processed_data = processed_data.replace("<tbody>", "");
            processed_data = processed_data.replace("</tbody>", "");
            processed_data = processed_data.replaceAll("<tr>", "");
            processed_data = processed_data.replaceAll("</tr>", "");

            while (processed_data.includes("<td>")) {
                object_temp1 = processed_data.slice(processed_data.indexOf(">") + 1, processed_data.indexOf("</td>"));
                processed_data = processed_data.replace(processed_data.slice(processed_data.indexOf("<td>"), processed_data.indexOf("</td>") + "</td>".length), "");
                object_temp2 = Number(processed_data.slice(processed_data.indexOf(">") + 1, processed_data.indexOf("</td>") - 1));
                processed_data = processed_data.replace(processed_data.slice(processed_data.indexOf("<td>"), processed_data.indexOf("</td>") + "</td>".length), "");
                option[object_temp1] = object_temp2;
            }

            return option
        }

        function set_grade(select) {
            $('#select_grade').val(select);
            $("#select_grade_btn").css("background-color", "green");
        }

        function set_parts(select) {
            $('#select_parts_type').val(select)
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>